"use strict";const e=require("../../common/vendor.js"),r=require("../../store/yuyue.js"),a=require("../../store/user.js"),c={data(){return{loading:!1,yuyueClass:"yuyue-box1",yuyueInfo:{peopleNumber:"",userName:"",userPhone:"",datetimesingle:""},today:"",userInfo:{code:""},index:0,arr:[1,2,3,4]}},onLoad(){this.setToday(),console.log(0xa1b01d4b1c7),this.getAllBusinesses(),console.log(222222222222)},onShow(){this.setToday()},onReady(){},computed:{...e.mapStores(r.useCounterStore,a.useUserStore),...e.mapState(a.useUserStore,["myUserInfo"]),...e.mapState(r.useCounterStore,["businessInfo"])},methods:{...e.mapActions(r.useCounterStore,["insertYuyue",,"getAllBusinessin"]),...e.mapActions(a.useUserStore,["login","islogin"]),setToday(){const o=new Date,t=o.getFullYear(),u=String(o.getMonth()+1).padStart(2,"0"),l=String(o.getDate()).padStart(2,"0"),s=String(o.getHours()).padStart(2,"0"),i=String(o.getMinutes()).padStart(2,"0");this.today=`${t}-${u}-${l} ${s}:${i}`},handleChange(o){console.log("日期"+o)},yuyueSure(o){console.log(this.yuyueInfo),console.log(0x27797f26d671c8),console.log(this.businessInfo.name),console.log(this.myUserInfo.id),console.log(0x27797f26d671c8);const t=new Date(this.yuyueInfo.datetimesingle).getTime(),u=new Date().getTime(),l=u+7*24*60*60*1e3;this.yuyueInfo.datetimesingle==""?e.index.showToast({title:"请选择日期",icon:"error"}):this.yuyueInfo.userPhone==""?e.index.showToast({title:"请输入电话",icon:"error"}):this.yuyueInfo.userName==""?e.index.showToast({title:"请输入姓名",icon:"error"}):this.yuyueInfo.userName.length>10?e.index.showToast({title:"请输入正确的昵称",icon:"error"}):this.yuyueInfo.peopleNumber==""?e.index.showToast({title:"请选择人数",icon:"error"}):this.yuyueInfo.userPhone.length<11?e.index.showToast({title:"请输入正确的电话号码",icon:"none"}):t<u?e.index.showToast({title:"选择有误",icon:"none"}):t>l?e.index.showToast({title:"请选择7天内的日期",icon:"none"}):this.insertYuyue({bookNumber:this.yuyueInfo.peopleNumber,bookDate:this.yuyueInfo.datetimesingle,bookName:this.yuyueInfo.userName,bookPhone:this.yuyueInfo.userPhone,businessName:this.businessInfo.name,userId:this.myUserInfo.id}).then(s=>{console.log("预约结果",s),s.code==2e4?e.index.showToast({title:"预约成功",icon:"success"}):e.index.showToast({title:"网络请请求失败",icon:"loading"})}).catch(s=>{console.error("预约失败",s),e.index.showToast({title:"网络请求失败",icon:"loading"})}),this.yuyueInfo={peopleNumber:"",userName:"",userPhone:"",datetimesingle:""},this.yuyueClass="yuyue-box1"},yuyueCancel(){this.yuyueInfo={peopleNumber:"",userName:"",userPhone:"",datetimesingle:""},this.yuyueClass="yuyue-box1"},getUserProfile(){console.log(this.myUserInfo),this.myUserInfo.name==""||this.myUserInfo.image==""?(console.log("未登录"),e.wx$1.login({success:o=>{console.log("res",o),console.log("this ",this),this.userInfo.code=o.code,this.login(this.userInfo).then(t=>{console.log("登录结果",t),this.myUserInfo.id=t.data.id,console.log(this.myUserInfo.id)}).catch(t=>{console.error("登录失败",t)})}}),e.wx$1.getUserProfile({desc:"测试",success:o=>{console.log("进来了"),console.log(o),console.log(o.userInfo.nickName),console.log(o.userInfo.avatarUrl),this.myUserInfo.name=o.userInfo.nickName,this.myUserInfo.image=o.userInfo.avatarUrl,console.log(this.myUserInfo),this.yuyueClass="yuyue-box"},fail:o=>{console.log(o),e.wx$1.showToast({title:"拒绝授权",icon:"error",duration:2e3})}})):(console.log("一登陆"),this.yuyueClass="yuyue-box")},testtes(){this.userStore.islogin()},bindChange(o){console.log("picker发送选择改变，携带值为",o.detail.value),this.index=o.detail.value,this.businessInfo.name=this.arr[this.index],console.log(this.businessInfo.name)},getAllBusinesses(){this.getAllBusinessin().then(o=>{console.log(0xa1b01d4b1c7),console.log(o.data),console.log(222222222222);for(let t=0;t<o.data.length;t++)this.arr[t]=o.data[t].businessName;console.log(this.arr),this.businessInfo.name=this.arr[this.index]}).catch(o=>{console.log(o)})}}};Array||e.resolveComponent("uni-datetime-picker")();const y=()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js";Math||y();function h(o,t,u,l,s,i){return{a:e.t(s.arr[s.index]),b:s.index,c:s.arr,d:e.o((...n)=>i.bindChange&&i.bindChange(...n)),e:e.o((...n)=>i.getUserProfile&&i.getUserProfile(...n)),f:e.o((...n)=>i.getAllBusinesses&&i.getAllBusinesses(...n)),g:s.yuyueInfo.peopleNumber,h:e.o(n=>s.yuyueInfo.peopleNumber=n.detail.value),i:e.o(i.handleChange),j:e.o(n=>s.yuyueInfo.datetimesingle=n),k:e.p({type:"datetime","clear-icon":!1,start:s.today,modelValue:s.yuyueInfo.datetimesingle}),l:s.yuyueInfo.userName,m:e.o(n=>s.yuyueInfo.userName=n.detail.value),n:s.yuyueInfo.userPhone,o:e.o(n=>s.yuyueInfo.userPhone=n.detail.value),p:e.o((...n)=>i.yuyueCancel&&i.yuyueCancel(...n)),q:e.o((...n)=>i.yuyueSure&&i.yuyueSure(...n)),r:e.n(s.yuyueClass)}}const m=e._export_sfc(c,[["render",h],["__file","C:/E/h/total/SummerPockets/uniapp-consumer-ui/pages/index/index.vue"]]);wx.createPage(m);
